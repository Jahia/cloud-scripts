---
type: update
version: 1.5.2
name: Jahia - Digital Experience Manager
logo: /images/jahia-logo-70x70.png
id: upgrade-v1.5

onInstall:
  - if (nodes.proc):  # Jahia
      - redeployMariadbNodes
  - else:  # Unomi
      - redeployEsNodes  # PAAS-1087

actions:
  manageKarafService:
    - cmd[cp]: systemctl ${this} karaf
      user: root

  redeployEsNodes:
    - manageKarafService: stop
    - api: environment.control.redeploycontainersbygroup
      nodeGroup: es
      tag: ${nodes.es.first.version}
      useExistingVolumes: true
    - manageKarafService: start

  redeployMariadbNodes:
    log: "todo"
