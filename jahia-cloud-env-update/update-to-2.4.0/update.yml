---
type: update
version: 1.5.2
name: Update v2.4.0
logo: /images/jahia-logo-70x70.png
id: update-v2.4.0

onInstall:
  - if (nodes.proc):  # Jahia
      - jelasticPackageLogsJahia # PAAS-1237
  - else:  # Unomi
      - jelasticPackageLogsUnomi # PAAS-1237

actions:
  jelasticPackageLogsJahia:
    - jelasticPackageLogsPermissions:
        target: "proc,cp"
        user: tomcat
    - jelasticPackageLogsPermissions:
        target: sqldb
        user: mysql
    - jelasticPackageLogsPermissions:
        target: bl
        user: haproxy

  jelasticPackageLogsUnomi:
    jelasticPackageLogsPermissions:
      target: "es,cp"
      user: root

  jelasticPackageLogsPermissions:
    - cmd[${this.target}]: |-
        mkdir -p /etc/datadog-agent/conf.d/jelastic.d /var/log/jelastic-packages
        chown ${this.user}:root /var/log/jelastic-packages
        chown dd-agent: /etc/datadog-agent/conf.d/jelastic.d
        wget -qO /etc/datadog-agent/conf.d/jelastic.d/conf.yaml ${baseUrl}/dd_agent_jelastic_package_conf.yml
        systemctl restart datadog-agent
      user: root
